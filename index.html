<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENUSA - Kesehatan Mental Nusantara</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-wrapper">
        <nav class="navbar">
            <div class="navbar-brand">SENUSA</div>
            <ul class="navbar-links">
                <li><a href="#welcome" class="nav-link active">Beranda</a></li>
                <li><a href="#features" class="nav-link">Fitur</a></li>
                <li id="nav-auth-link"><a href="#auth-combined" class="nav-link">Login/Daftar</a></li>
                <li id="nav-dashboard-link" class="hidden"><a href="#dashboard" class="nav-link">Dashboard</a></li>
                <li id="nav-logout-link" class="hidden"><a href="#" class="nav-link">Logout</a></li>
            </ul>
        </nav>

        <section id="welcome" class="welcome-section">
            <div class="welcome-content">
                <div class="icon-container">
                    <i class="fas fa-heart icon"></i>
                    <i class="fas fa-seedling icon"></i>
                </div>
                <div class="icon-container right">
                    <i class="fas fa-hand-holding-heart icon"></i>
                    <i class="fas fa-leaf icon"></i>
                </div>

                <h1 class="main-title">Selamat Datang di SENUSA</h1>
                <h2 class="subtitle">Sehat Nusantara Sadar</h2>
                <p class="tagline">Platform Dedikasi untuk Kesehatan dan Kesadaran Bangsa</p>
            </div>
            <div class="welcome-bottom">
                <a href="#features" class="start-button">Mulai Jelajahi Fitur</a>
            </div>
            <div class="circle welcome-circle-top-right"></div>
            <div class="circle welcome-circle-bottom-left"></div>
        </section>

        <section id="features" class="features-section">
            <header class="features-header">
                <h2 class="features-heading">Jelajahi Fitur Unggulan Kami</h2>
                <p class="features-tagline">Temukan solusi inovatif yang dirancang khusus untuk mendukung kesehatan mental dan kesejahteraan Anda.</p>
            </header>

            <div class="features-grid">
                <div class="feature-card card-blue">
                    <div class="card-icon-wrapper">
                        <i class="fas fa-map-marked-alt card-icon"></i>
                    </div>
                    <h3 class="card-title">Peta Interaktif</h3>
                    <p class="card-description">Telusuri kondisi kesehatan mental tiap provinsi dengan visual menarik. Dilengkapi fitur pendukung untuk setiap wilayah.</p>
                    <button class="card-button primary-btn" data-target="peta-content" data-login-required="true">Lihat Peta</button>
                </div>

                <div class="feature-card card-purple">
                    <div class="card-icon-wrapper">
                        <i class="fas fa-book-open card-icon"></i>
                    </div>
                    <h3 class="card-title">Ruang Budaya & Edukasi</h3>
                    <p class="card-description">Modul inspiratif berupa eBook, komik, dan cerita rakyat, mengintegrasikan nilai-nilai budaya lokal dalam pemulihan mental.</p>
                    <button class="card-button primary-btn" data-target="budaya-content" data-login-required="true">Jelajahi Budaya</button>
                </div>

                <div class="feature-card card-orange">
                    <div class="card-icon-wrapper">
                        <i class="fas fa-question-circle card-icon"></i>
                    </div>
                    <h3 class="card-title">Tes Interaktif & Kuis</h3>
                    <p class="card-description">Ikuti kuis dan tes psikologi yang dirancang untuk membantu Anda memahami kondisi mental secara mandiri dan mendalam.</p>
                    <button class="card-button primary-btn" data-target="kuis-content" data-login-required="true">Mulai Kuis</button>
                </div>

                <div class="feature-card wide-card card-green">
                    <div class="card-icon-wrapper">
                        <i class="fas fa-calendar-alt card-icon"></i>
                    </div>
                    <h3 class="card-title">Kalender Self-Care</h3>
                    <p class="card-description">Buat jadwal aktivitas harian untuk menjaga kestabilan emosional. Rutinitas harian yang sehat dan mindfulness kini dalam genggaman.</p>
                    <button class="card-button primary-btn" data-target="kalender-content" data-login-required="true">Buat Jadwal</button>
                </div>
            </div>
        </section>

        <section id="peta-content" class="feature-detail-section hidden">
            <div class="feature-detail-container">
                <button class="close-btn">&times;</button>
                <h2>Peta Interaktif Kesehatan Mental</h2>
                <p>Fitur peta interaktif kami sedang dalam pengembangan intensif untuk memberikan data yang paling akurat dan relevan mengenai kondisi kesehatan mental di seluruh provinsi di Indonesia. Anda akan dapat menjelajahi statistik, menemukan fasilitas kesehatan mental terdekat, dan sumber daya pendukung lainnya di setiap wilayah.</p>
                <div class="map-placeholder">
                    <i class="fas fa-map-marked-alt fa-5x"></i>
                    <p>Peta visual akan ditampilkan di sini</p>
                    <p>Segera hadir dengan data dan fitur yang lengkap!</p>
                </div>
                <button class="primary-btn back-to-features-btn">Kembali ke Fitur Utama</button>
            </div>
        </section>

        <section id="budaya-content" class="feature-detail-section hidden">
            <div class="feature-detail-container">
                <button class="close-btn">&times;</button>
                <h2>Ruang Budaya & Edukasi</h2>
                <p>Temukan kekayaan pengetahuan dan inspirasi melalui koleksi E-Book, Komik, dan Cerita Rakyat kami yang mengintegrasikan nilai-nilai budaya lokal dengan prinsip kesehatan mental.</p>
                <div class="content-grid">
                    <div class="content-item">
                        <img src="https://via.placeholder.com/150x200/ADD8E6/FFFFFF?text=E-Book+1" alt="E-Book 1">
                        <h4>E-Book: Merajut Ketenangan</h4>
                        <p>Panduan praktik mindfulness dari kearifan lokal.</p>
                        <button class="small-btn">Baca Sekarang</button>
                    </div>
                    <div class="content-item">
                        <img src="https://via.placeholder.com/150x200/90EE90/FFFFFF?text=Komik+1" alt="Komik 1">
                        <h4>Komik: Petualangan Batin</h4>
                        <p>Kisah inspiratif tentang perjuangan mencari jati diri.</p>
                        <button class="small-btn">Lihat Komik</button>
                    </div>
                    <div class="content-item">
                        <img src="https://via.placeholder.com/150x200/FFDAB9/FFFFFF?text=Cerita+Rakyat" alt="Cerita Rakyat">
                        <h4>Cerita Rakyat: Legenda Empati</h4>
                        <p>Pelajari tentang empati dari dongeng nenek moyang.</p>
                        <button class="small-btn">Baca Cerita</button>
                    </div>
                </div>
                <button class="primary-btn back-to-features-btn">Kembali ke Fitur Utama</button>
            </div>
        </section>

        <section id="kuis-content" class="feature-detail-section hidden">
            <div class="feature-detail-container">
                <button class="close-btn">&times;</button>
                <h2>Tes Interaktif & Kuis</h2>
                <p>Uji pemahaman Anda tentang kesehatan mental dan diri sendiri melalui kuis dan tes yang kami sediakan. Hasil tes bersifat informatif dan bukan diagnosis medis.</p>
                <div class="quiz-area">
                    <h3>Kuis Kecerdasan Emosional Dasar</h3>
                    <p>Pertanyaan 1/5: Bagaimana Anda bereaksi ketika merasa stres?</p>
                    <ul class="quiz-options">
                        <li><input type="radio" name="q1" value="a"> Mencari dukungan dari teman atau keluarga.</li>
                        <li><input type="radio" name="q1" value="b"> Menyendiri dan memprosesnya sendiri.</li>
                        <li><input type="radio" name="q1" value="c"> Merasa frustasi dan mudah marah.</li>
                    </ul>
                    <p class="quiz-note">Kuis ini hanya contoh. Fitur penuh akan segera hadir!</p>
                    <button class="primary-btn">Lanjut Kuis</button>
                </div>
                <button class="primary-btn back-to-features-btn">Kembali ke Fitur Utama</button>
            </div>
        </section>

        <section id="kalender-content" class="feature-detail-section hidden">
            <div class="feature-detail-container">
                <button class="close-btn">&times;</button>
                <h2>Kalender Self-Care</h2>
                <p>Rencanakan rutinitas self-care harian atau mingguan Anda. Mengatur jadwal aktivitas positif dapat membantu menjaga keseimbangan mental dan emosional.</p>
                <div class="calendar-placeholder">
                    <i class="fas fa-calendar-alt fa-5x"></i>
                    <h3>Buat Jadwal Self-Care Anda</h3>
                    <form class="selfcare-form">
                        <div class="input-group">
                            <label for="activity-name">Nama Aktivitas:</label>
                            <input type="text" id="activity-name" placeholder="Contoh: Meditasi, Olahraga, Membaca">
                        </div>
                        <div class="input-group">
                            <label for="activity-time">Waktu:</label>
                            <input type="time" id="activity-time">
                        </div>
                        <div class="input-group">
                            <label for="activity-day">Hari:</label>
                            <select id="activity-day">
                                <option value="setiap-hari">Setiap Hari</option>
                                <option value="senin">Senin</option>
                                <option value="selasa">Selasa</option>
                                <option value="rabu">Rabu</option>
                                <option value="kamis">Kamis</option>
                                <option value="jumat">Jumat</option>
                                <option value="sabtu">Sabtu</option>
                                <option value="minggu">Minggu</option>
                            </select>
                        </div>
                        <button type="submit" class="primary-btn">Tambahkan Aktivitas</button>
                    </form>
                </div>
                <button class="primary-btn back-to-features-btn">Kembali ke Fitur Utama</button>
            </div>
        </section>

        <section id="auth-combined" class="auth-section">
            <div class="auth-container">
                <div class="auth-tabs">
                    <button class="tab-button active" data-tab="login-tab">Login</button>
                    <button class="tab-button" data-tab="register-tab">Daftar</button>
                </div>

                <div id="login-tab" class="auth-tab-content active">
                    <div class="auth-header">
                        <h2 class="auth-title">Selamat Datang Kembali</h2>
                        <p class="auth-subtitle">Silakan masuk untuk melanjutkan perjalanan Anda bersama SENUSA.</p>
                        <p id="login-message" class="auth-message"></p>
                    </div>
                    <form class="auth-form" id="login-form">
                        <div class="input-group">
                            <label for="login-username">Username atau Email</label>
                            <input type="text" id="login-username" name="login-username" placeholder="Masukkan username atau email Anda" required>
                        </div>
                        <div class="input-group">
                            <label for="login-password">Kata Sandi</label>
                            <input type="password" id="login-password" name="login-password" placeholder="Masukkan kata sandi Anda" required>
                        </div>
                        <div class="form-options">
                            <label class="checkbox-container">
                                <input type="checkbox" checked="checked"> Ingat saya
                                <span class="checkmark"></span>
                            </label>
                            <a href="#" class="forgot-password">Lupa Kata Sandi?</a>
                        </div>
                        <button type="submit" class="auth-button primary-btn">Login</button>
                    </form>
                    <div class="auth-footer">
                        <p>Belum punya akun? <a href="#" class="auth-link switch-tab-link" data-tab="register-tab">Daftar Sekarang</a></p>
                    </div>
                </div>

                <div id="register-tab" class="auth-tab-content hidden">
                    <div class="auth-header">
                        <h2 class="auth-title">Buat Akun Baru</h2>
                        <p class="auth-subtitle">Bergabunglah dengan SENUSA dan mulai perjalanan kesehatan mental Anda.</p>
                        <p id="register-message" class="auth-message"></p>
                    </div>
                    <form class="auth-form" id="registration-form">
                        <div class="input-group">
                            <label for="reg-fullname">Nama Lengkap</label>
                            <input type="text" id="reg-fullname" name="reg-fullname" placeholder="Masukkan nama lengkap Anda" required>
                        </div>
                        <div class="input-group">
                            <label for="reg-email">Email</label>
                            <input type="email" id="reg-email" name="reg-email" placeholder="Masukkan email aktif Anda" required>
                        </div>
                        <div class="input-group">
                            <label for="reg-username">Username</label>
                            <input type="text" id="reg-username" name="reg-username" placeholder="Buat username Anda" required>
                        </div>
                        <div class="input-group">
                            <label for="reg-password">Kata Sandi</label>
                            <input type="password" id="reg-password" name="reg-password" placeholder="Buat kata sandi Anda" required>
                        </div>
                        <div class="input-group">
                            <label for="reg-confirm-password">Konfirmasi Kata Sandi</label>
                            <input type="password" id="reg-confirm-password" name="reg-confirm-password" placeholder="Ulangi kata sandi Anda" required>
                        </div>
                        <button type="submit" class="auth-button primary-btn">Daftar</button>
                    </form>

                    <form class="auth-form hidden" id="verification-form">
                        <p>Kami telah mengirim kode verifikasi ke email Anda. Silakan masukkan kode di bawah ini.</p>
                        <p class="auth-message info small" id="verification-email-info">Kode verifikasi (SIMULASI) untuk <span id="verif-email-display"></span> adalah: <strong id="simulated-code"></strong></p>
                        <div class="input-group">
                            <label for="verification-code">Kode Verifikasi</label>
                            <input type="text" id="verification-code" name="verification-code" placeholder="Masukkan kode 6 digit Anda" required maxlength="6">
                        </div>
                        <button type="submit" class="auth-button primary-btn">Verifikasi Akun</button>
                        <p class="resend-code">Tidak menerima kode? <a href="#" id="resend-code-link">Kirim ulang kode (SIMULASI)</a></p>
                    </form>

                    <div class="auth-footer">
                        <p>Sudah punya akun? <a href="#" class="auth-link switch-tab-link" data-tab="login-tab">Login di sini</a></p>
                    </div>
                </div>
                <div class="auth-footer-bottom">
                    <p><a href="#welcome" class="auth-link">Kembali ke Beranda</a></p>
                </div>
            </div>
        </section>

        <section id="dashboard" class="dashboard-section hidden">
            <div class="dashboard-container">
                <h2>Selamat Datang, <span id="dashboard-username">Pengguna</span>!</h2>
                <p>Anda telah berhasil masuk ke akun SENUSA Anda. Jelajahi fitur-fitur eksklusif di bawah ini.</p>
                <div class="dashboard-stats">
                    <div class="stat-item">
                        <h3><i class="fas fa-heartbeat"></i> Status Mental</h3>
                        <p>Belum ada data</p>
                    </div>
                    <div class="stat-item">
                        <h3><i class="fas fa-chart-line"></i> Progres</h3>
                        <p>Aktivitas terakhir: Kuis Emosional</p>
                    </div>
                </div>
                <button class="primary-btn" onclick="window.location.hash='#features'">Jelajahi Fitur</button>
                <button class="primary-btn logout-btn">Logout</button>
            </div>
        </section>

        <footer class="footer">
            <p>&copy; 2025 SENUSA – Platform Kesehatan Mental Nusantara. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.navbar-links .nav-link');
            const sections = document.querySelectorAll('section:not(.feature-detail-section)');
            const featureButtons = document.querySelectorAll('.feature-card .primary-btn');
            const featureDetailSections = document.querySelectorAll('.feature-detail-section');
            const closeButtons = document.querySelectorAll('.feature-detail-section .close-btn');
            const backToFeaturesButtons = document.querySelectorAll('.feature-detail-section .back-to-features-btn');

            const navbarHeight = document.querySelector('.navbar').offsetHeight;

            // Auth Elements - Combined Section
            const authTabs = document.querySelectorAll('.auth-tabs .tab-button');
            const authTabContents = document.querySelectorAll('.auth-tab-content');
            const registrationForm = document.getElementById('registration-form');
            const verificationForm = document.getElementById('verification-form');
            const loginForm = document.getElementById('login-form');
            const registerMessage = document.getElementById('register-message');
            const loginMessage = document.getElementById('login-message');
            const resendCodeLink = document.getElementById('resend-code-link');
            const simulatedCodeDisplay = document.getElementById('simulated-code');
            const verificationEmailInfo = document.getElementById('verification-email-info');
            const verifEmailDisplay = document.getElementById('verif-email-display');
            const switchTabLinks = document.querySelectorAll('.switch-tab-link');


            const dashboardSection = document.getElementById('dashboard');
            const dashboardUsername = document.getElementById('dashboard-username');
            const logoutButtons = document.querySelectorAll('.logout-btn');

            // Navbar elements to toggle visibility
            const navAuthLink = document.getElementById('nav-auth-link'); // Combined Auth link
            const navDashboardLink = document.getElementById('nav-dashboard-link');
            const navLogoutLink = document.getElementById('nav-logout-link');

            let currentUser = null; // Simpan data pengguna yang sedang login
            let generatedVerificationCode = null; // Kode verifikasi yang digenerate

            // --- Utility Functions ---
            function scrollToSection(targetId) {
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    window.scrollTo({
                        top: targetSection.offsetTop - navbarHeight,
                        behavior: 'smooth'
                    });
                }
            }

            function updateNavbarLinks(loggedIn) {
                if (loggedIn) {
                    navAuthLink.classList.add('hidden');
                    navDashboardLink.classList.remove('hidden');
                    navLogoutLink.classList.remove('hidden');
                } else {
                    navAuthLink.classList.remove('hidden');
                    navDashboardLink.classList.add('hidden');
                    navLogoutLink.classList.add('hidden');
                }
            }

            function showAuthMessage(element, message, type = 'info') {
                element.textContent = message;
                element.className = `auth-message ${type}`;
                element.classList.remove('hidden');
                setTimeout(() => {
                    element.classList.add('hidden');
                    element.textContent = '';
                }, 5000);
            }

            // Function to handle login state
            function setLoginState(user = null) {
                currentUser = user;
                if (currentUser) {
                    localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
                    updateNavbarLinks(true);
                    dashboardUsername.textContent = currentUser.fullname || currentUser.username;
                    featureButtons.forEach(button => {
                        button.disabled = false;
                        button.style.cursor = 'pointer';
                        button.style.opacity = '1';
                    });
                    console.log(`User ${currentUser.username} logged in.`);
                } else {
                    localStorage.removeItem('loggedInUser');
                    updateNavbarLinks(false);
                    featureButtons.forEach(button => {
                        if (button.dataset.loginRequired === 'true') {
                            button.disabled = true;
                            button.style.cursor = 'not-allowed';
                            button.style.opacity = '0.6';
                        }
                    });
                    console.log('User logged out.');
                }
            }

            // Check login status on page load
            const storedUser = localStorage.getItem('loggedInUser');
            if (storedUser) {
                setLoginState(JSON.parse(storedUser));
            } else {
                setLoginState(null);
            }

            // --- Main Navigation Logic ---
            const initialHash = window.location.hash || '#welcome';
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === initialHash) {
                    link.classList.add('active');
                }
            });
            if (initialHash !== '#welcome') {
                scrollToSection(initialHash.substring(1));
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);

                    if (targetId === '') { // Logout link has href="#"
                        setLoginState(null);
                        window.location.hash = '#welcome';
                        scrollToSection('welcome');
                        navLinks.forEach(item => item.classList.remove('active'));
                        document.querySelector('.navbar-links li a[href="#welcome"]').classList.add('active');
                        return;
                    }

                    featureDetailSections.forEach(section => section.classList.add('hidden'));

                    scrollToSection(targetId);

                    navLinks.forEach(item => item.classList.remove('active'));
                    this.classList.add('active');

                    history.pushState(null, null, this.getAttribute('href'));
                });
            });

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - navbarHeight;
                    const sectionHeight = section.clientHeight;
                    if (pageYOffset >= sectionTop && pageYOffset < sectionTop + sectionHeight) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            });

            // --- Feature Button Logic (with Login Requirement) ---
            featureButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.dataset.target;
                    const loginRequired = this.dataset.loginRequired === 'true';

                    if (loginRequired && !currentUser) {
                        alert('Anda harus login terlebih dahulu untuk mengakses fitur ini!');
                        scrollToSection('auth-combined'); // Scroll to combined auth
                        // Optionally switch to login tab if user is redirected here
                        document.querySelector('.auth-tabs .tab-button[data-tab="login-tab"]').click();
                        return;
                    }

                    featureDetailSections.forEach(section => section.classList.add('hidden'));

                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.remove('hidden');
                        scrollToSection(targetId);
                        history.pushState(null, null, `#${targetId}`);
                    }
                });
            });

            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.feature-detail-section').classList.add('hidden');
                    scrollToSection('features');
                    history.pushState(null, null, '#features');
                });
            });

            backToFeaturesButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.feature-detail-section').classList.add('hidden');
                    scrollToSection('features');
                    history.pushState(null, null, '#features');
                });
            });

            // --- Combined Auth Tabs Logic ---
            function switchAuthTab(tabId) {
                authTabContents.forEach(content => {
                    if (content.id === tabId) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
                authTabs.forEach(button => {
                    if (button.dataset.tab === tabId) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
                // Reset form visibility if switching from verification
                if (tabId === 'register-tab') {
                    registrationForm.classList.remove('hidden');
                    verificationForm.classList.add('hidden');
                    registerMessage.classList.add('hidden'); // Clear messages on tab switch
                } else if (tabId === 'login-tab') {
                    loginMessage.classList.add('hidden'); // Clear messages on tab switch
                }
            }

            authTabs.forEach(button => {
                button.addEventListener('click', function() {
                    switchAuthTab(this.dataset.tab);
                });
            });

            // Handle switching tabs from links (e.g., "Daftar Sekarang" in login form)
            switchTabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    switchAuthTab(this.dataset.tab);
                });
            });

            // --- Registration Logic ---
            registrationForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const fullname = document.getElementById('reg-fullname').value;
                const email = document.getElementById('reg-email').value;
                const username = document.getElementById('reg-username').value;
                const password = document.getElementById('reg-password').value;
                const confirmPassword = document.getElementById('reg-confirm-password').value;

                if (password !== confirmPassword) {
                    showAuthMessage(registerMessage, 'Kata sandi tidak cocok!', 'error');
                    return;
                }

                const existingUsers = JSON.parse(localStorage.getItem('users')) || [];
                const userExists = existingUsers.some(user => user.username === username || user.email === email);

                if (userExists) {
                    showAuthMessage(registerMessage, 'Username atau Email sudah terdaftar!', 'error');
                    return;
                }

                // Simulate sending verification code
                generatedVerificationCode = Math.floor(100000 + Math.random() * 900000).toString(); // 6 digit code
                localStorage.setItem('tempUser', JSON.stringify({ fullname, email, username, password, verified: false, verificationCode: generatedVerificationCode }));

                // Display simulated code clearly
                verifEmailDisplay.textContent = email;
                simulatedCodeDisplay.textContent = generatedVerificationCode;
                verificationEmailInfo.classList.remove('hidden'); // Show the info message

                showAuthMessage(registerMessage, `Pendaftaran berhasil! Kode verifikasi telah 'dikirim' ke email Anda (${email}). Silakan masukkan kode. (Lihat kode di atas form verifikasi)`, 'success');
                registrationForm.classList.add('hidden');
                verificationForm.classList.remove('hidden');
                document.getElementById('verification-code').value = ''; // Clear previous input
            });

            // --- Verification Logic ---
            verificationForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const inputCode = document.getElementById('verification-code').value;
                const tempUser = JSON.parse(localStorage.getItem('tempUser'));

                if (!tempUser) {
                    showAuthMessage(registerMessage, 'Terjadi kesalahan. Silakan daftar ulang.', 'error');
                    registrationForm.classList.remove('hidden');
                    verificationForm.classList.add('hidden');
                    verificationEmailInfo.classList.add('hidden');
                    return;
                }

                if (inputCode === tempUser.verificationCode) {
                    tempUser.verified = true;
                    delete tempUser.verificationCode;

                    const users = JSON.parse(localStorage.getItem('users')) || [];
                    users.push(tempUser);
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.removeItem('tempUser');

                    showAuthMessage(registerMessage, 'Akun Anda berhasil diverifikasi! Silakan login.', 'success');
                    verificationForm.classList.add('hidden');
                    registrationForm.classList.remove('hidden'); // Show register form again, or redirect to login
                    verificationEmailInfo.classList.add('hidden');
                    switchAuthTab('login-tab'); // Switch to login tab
                    scrollToSection('auth-combined');
                } else {
                    showAuthMessage(registerMessage, 'Kode verifikasi salah. Silakan coba lagi.', 'error');
                }
            });

            resendCodeLink.addEventListener('click', function(e) {
                e.preventDefault();
                const tempUser = JSON.parse(localStorage.getItem('tempUser'));
                if (tempUser) {
                    generatedVerificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                    tempUser.verificationCode = generatedVerificationCode;
                    localStorage.setItem('tempUser', JSON.stringify(tempUser));
                    simulatedCodeDisplay.textContent = generatedVerificationCode; // Update the displayed code
                    showAuthMessage(registerMessage, `Kode verifikasi baru (${generatedVerificationCode}) telah 'dikirim' ke email Anda (${tempUser.email}).`, 'info');
                } else {
                    showAuthMessage(registerMessage, 'Tidak ada pendaftaran yang tertunda untuk mengirim ulang kode.', 'error');
                }
            });

            // --- Login Logic ---
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const loginUsername = document.getElementById('login-username').value;
                const loginPassword = document.getElementById('login-password').value;

                const users = JSON.parse(localStorage.getItem('users')) || [];
                const foundUser = users.find(user => (user.username === loginUsername || user.email === loginUsername) && user.password === loginPassword);

                if (foundUser) {
                    if (!foundUser.verified) {
                        showAuthMessage(loginMessage, 'Akun Anda belum diverifikasi. Silakan verifikasi email Anda terlebih dahulu.', 'error');
                        // Option: Automatically switch to register tab and show verification form again
                        localStorage.setItem('tempUser', JSON.stringify(foundUser)); // Temporarily put user back to temp storage
                        switchAuthTab('register-tab');
                        registrationForm.classList.add('hidden');
                        verificationForm.classList.remove('hidden');
                        verifEmailDisplay.textContent = foundUser.email;
                        simulatedCodeDisplay.textContent = foundUser.verificationCode || 'Tidak ada kode lama, coba kirim ulang.'; // If they somehow lost the code
                        verificationEmailInfo.classList.remove('hidden');
                        showAuthMessage(registerMessage, `Akun Anda belum diverifikasi. Kode verifikasi (SIMULASI) telah 'dikirim' kembali ke ${foundUser.email}.`, 'error');
                        return;
                    }
                    setLoginState(foundUser);
                    showAuthMessage(loginMessage, `Login berhasil! Selamat datang, ${foundUser.fullname || foundUser.username}!`, 'success');
                    scrollToSection('dashboard');
                } else {
                    showAuthMessage(loginMessage, 'Username/Email atau kata sandi salah.', 'error');
                }
            });

            // --- Logout Logic ---
            logoutButtons.forEach(button => {
                button.addEventListener('click', function() {
                    setLoginState(null);
                    showAuthMessage(loginMessage, 'Anda telah logout.', 'info');
                    dashboardSection.classList.add('hidden');
                    scrollToSection('welcome');
                    history.pushState(null, null, '#welcome');
                });
            });
        });
    </script>
</body>
</html>